<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /home/app
    
    # Enable Passenger
    PassengerEnabled on
    PassengerAppType node
    PassengerStartupFile server.cjs
    PassengerAppRoot /home/app
    PassengerUser app
    PassengerGroup app
    
    # Node.js environment
    PassengerAppEnv production
    PassengerNodejs /usr/bin/node
    PassengerMinInstances 1
    
    # Logging
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    
    # Handle all requests through the Node.js app
    <Directory "/home/app">
        AllowOverride None
        Require all granted
    </Directory>
    
    # Passenger configuration
    <LocationMatch "^/.*">
        PassengerEnabled on
    </LocationMatch>
</VirtualHost>